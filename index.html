<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width = device-width, initial-scale = 1">
  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="index.css" />
  <link rel="stylesheet" type="text/css" href="common.css">
  <title>IWMI</title>
</head>

<body>
  <div class="container" style="height:100%;width:100%;">
    <nav class="navbar navbar-default">
      <div class="container-fluid" style="height:100%;width:100%;">
        <div class="navbar-header"> <a class="navbar-brand" href="#">IWMI</a> </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#" id="mapNav">Map</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li id="loginNav"><a href="login.html">Login</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="map"></div>
  </div>
  <script src="lib/papaparse.js"></script>
  <script src="lib/markerclusterer.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script>
    var infowindow

    function myMap(text) {
      var center = {
        lat: 39.7684
        , lng: -86.1581
      };
      var data = Papa.parse(text);
      //
      console.log(data);
      console.log(data.data.length);
      //
      var mapCanvas = document.getElementById("map");
      var mapOptions = {
        center: center
        , zoom: 7
      };
      var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
      var map = new google.maps.Map(mapCanvas, mapOptions);
      //
      var markers = []
        //
      for (var i = 1; i < data.data.length; i++) {
        var point = {
          lat: parseFloat(data.data[i][20])
          , lng: parseFloat(data.data[i][21])
        };
        var marker = new google.maps.Marker({
          position: point
          , icon: {
            path: google.maps.SymbolPath.CIRCLE
            , scale: 2
          }
          , title: data.data[i][4]
        });
        markers[i - 1] = marker;
        (function (_marker) {
          if (infowindow) infowindow.close();
          //
          var content = '<h5><a href="' + data.data[i][13] + '">' + data.data[i][4] + '</a></h5><p><b>Agency:</b> ' + data.data[i][3] + '<br><b>Location:</b> ' + data.data[i][6] + '<br><b>Site Number:</b> ' + data.data[i][5] + '<br><b>Parameter(s) sampled:</b> ' + data.data[i][8] + '<br><b>Parameter Type:</b> ' + data.data[i][7] + '<br><b>Monitoring Frequency:</b> ' + data.data[i][9] + '<br><b>Publicly Availible?:</b> ' + data.data[i][10] + '<br><b>Data Quality Information:</b> ' + data.data[i][15] + '<br><b>Date of record:</b> ' + data.data[i][11] + ' to ' + data.data[i][12] + '<br><b>HUC12:</b> ' + data.data[i][19] + '</p>';
          //
          var infowindow = new google.maps.InfoWindow({
            content: content
            , maxWidth: 400
          })
          _marker.addListener('click', function () {
            infowindow.open(map, _marker);
          });
        }(marker));
      }
      console.log(markers);
      // Add a marker clusterer to manage the markers.
      var markerCluster = new MarkerClusterer(map, markers, {
        imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
        , maxZoom: 15
      });
      console.log("Max zoom: " + markerCluster.getMaxZoom());
    }
    $(document).ready(function () {
      $.ajax({
        type: "GET"
        , url: "res/inwater.csv"
        , dataType: "text"
        , success: function (data) {
          myMap(data);
        }
      })
    });
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASiSo-iDClClxEHgAGFYGvz55dAXIYJWw&callback=myMap"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>

</html>